<!DOCTYPE html>
<html>

<head>
    <title>IITOverflow</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="../static/js/jQuery-tagEditor-master/jquery.tag-editor.css" />
    <link rel="stylesheet" href="../static/js/jquery-ui-1.12.1.custom/jquery-ui.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="../static/js/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="../static/js/jQuery-tagEditor-master/jquery.tag-editor.min.js"></script>
    <script src="../static/js/jQuery-tagEditor-master/jquery.caret.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="../static/css/newsfeed.css">
    <link rel="stylesheet" href="../static/css/new.css">

    <script src="../static/ckeditor/ckeditor.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <link href="../static/css/fontawesome-all.css" rel="stylesheet">


</head>


<body>
    <div class="hider" id="hider"> </div>

    <div class="fullpage">



        <div class="section">
            <div class="landing">
                <div class="nav">
                    <input id="autocomplete" class="searchbar" type="text" placeholder="Search..">
                    <button class="searchbutton" type="submit"><i>Go!</i></button>
                    <div class="pages">

                        <a href="newsfeed">Home</a>
                        <a href="profile">Profile</a>
                        <a href="#">Notifications</a>
                        <a href="landing">Logout</a>

                    </div>




                </div>
                <div class="contentLeft">
                    <div class="links">

                        <div class="profilepicture">
                            <img class="backgroundpic" src="../static/images/background1.jpg">
                            <div class="picture">
                                <img class="profileimage" src="../static/images/phillip.jpg"> </div>
                        </div>
                        <div class="emailinfo">
                            <div class="namecont">
                                <a href="#">
                                    <h3>Phillip Espina
                                        <br> </h3>
                                </a>
                            </div>
                            <div class="emailcont">
                                <a>
                                    <h6>@phillipespina@g.msuiit.edu.ph</h6>
                                </a>
                            </div>
                        </div>

                        <div class="followerscont">
                            <a>
                                <h3>Followers</h3>
                            </a>
                        </div>
                        <div class="followingcont">
                            <a>
                                <h3>Following</h3>
                            </a>
                        </div>

                        <div class="followerscount">
                            <a>
                                <h3>1.5m</h3>
                            </a>
                        </div>
                        <div class="followingcount">
                            <a>
                                <h3>10</h3>
                            </a>
                        </div>



                    </div>
                    <div class="links0">

                    </div>
                </div>


                <div class="contentCenter">
                    <div class="askquestion" id="newpost">
                        <div class="askbuttons">
                            <input type="submit" value="Ask Something" class="Askbutton">

                        </div>

                        <form id="form1">
                            <textarea name="textarea" id="textarea" placeholder="Ask Something"></textarea>
                            <script>
                                CKEDITOR.replace('textarea');
                            </script>

                        </form>
                        <input placeholder="Add title here..." class="titlearea" type="textarea" name="title" id="title" />
                        <div style="margin: 20px;">
                            <input id="tagsID" type="text" name="tagsarea" class="tagsarea" />
                        </div>

                        <div class="popupwrapper">

                            <div class="popup" id="popup"><button class="categorybutton" id="myBtn"><b>Category :</b></button></div>
                        </div>
                        <a class="submitbutton3" type="submit">Submit</a>
                        <a class="submitbutton2" type="submit">Hide</a>
                    </div>

                    <div id="newsfeedParent">

                        {% for i in questions|reverse %}


                        <div id={{ "newqedit_{0}".format(i.id)}} style="display: block;" class="newdiv">

                            <button class="btn btn-danger" id={{ "duplicate_{0}".format(i.id)}} style="display: none;">DUPLICATE</button>

                            <div class="titlepost">Title: {{i.question|safe}}
                                <div class=" editanddeleteButtonCont">
                                    <i onclick="showhide({{i.id}})" class="fa fa-edit Newsfeed-editButton "></i>
                                    <i id={{i.id}} class="fas fa-trash-alt qheart"></i>
                                    <i onclick="showhide1({{i.id}})" class="fas fa-copy duplicate"></i>
                                </div>

                                <div>




                                </div>
                            </div>
                            <div class="descriptionpost">Description: {{i.questiondesc|safe}}
                                <div></div>
                            </div>
                            <div class="categorypost">Category: {{i.categoryId}}
                                <div></div>
                            </div>
                            <div class="tagspost">Tags: {% for tag in i.tags %} {{tag.name}} {% endfor %}

                                <div></div>
                            </div>
                            <div class="newpostbuttons"><button class="follow followbutton">
                                    <span class="msg-follow">Follow</span>
                                    <span class="msg-following">Following</span>
                                    <span class="msg-unfollow">Unfollow</span>
                                  </button><button class="votebutton">Vote</button><button><button class="commentbutton">Comment</button><button class="answerbutton">Answer</button></div>


                            <div>


                                {% for answer in i.answers %}

                                <div class="comments-container">
                                    <ul id="comments-list" class="comments-list">
                                        <li>
                                            <div class="comment-main-level">
                                                <!-- Avatar 
                    <div class="comment-avatar"><img src="http://i9.photobucket.com/albums/a88/creaticode/avatar_1_zps8e1c80cd.jpg" alt=""></div>
                    Contenedor del Comentario -->
                                                <div class="comment-box">
                                                    <div class="comment-head">
                                                        <h6 class="comment-name by-author"><a href="http://creaticode.com/blog">{{answer.userId}}</a></h6>
                                                        <span>Posted on: {{answer.createdAt}}</span>
                                                        <i id={{answer.id}} class="fa fa-reply edit"></i>
                                                        <i id={{answer.id}} class="fa fa-heart heart"></i>
                                                    </div>
                                                    <div class="comment-content">
                                                        {{answer.answer}}
                                                    </div>
                                                </div>
                                            </div>

                                        </li>

                                        <li>

                                        </li>
                                    </ul>
                                </div>

                                <!-- <h2>   {{answer.answer}} </h2> -->



                                {% endfor %}


                            </div>

                            <!-- TOEDIT -->



                            <div class="answerdiv">


                                <textarea class="answertextarea" id={{ "answer_{0}".format(i.id)}} placeholder="Write an Answer"> </textarea>





                                <input class="submitanswerbutton" id={{i.id}} value=submit type="button">




                                <div></div>
                            </div>
                            <div class="newpostinput"><input class="commenttextarea" placeholder="Write a Comment">
                                <div></div>
                            </div>

                        </div>





                        <!-- EDIT MODE -->

                        <div style="display: none;" id={{ "qedit_{0}".format(i.id)}} class="newdivEdit">


                            <form id="form2">

                                <i onclick="showhide({{i.id}})" class="fa fa-reply"></i>
                                <i id={{i.id}} class="fa fa-heart qheart"></i>





                                <input class="editQuestionTitle" type="text" id="titleedit" value={{i.question}}>

                                <input class="editTitleDescription" type="text" id="descedit" value={{i.questiondesc}}>

                                <div style="margin: 20px;">

                                    {% for tag in i.tags %}

                                    <input id="tagsIDedit" type="text" name="tagsarea" value={{tag.name}} class="tagsarea" /> {% endfor %}
                                </div>


                                <div class="newsfeedPopUpButton-Cont">

                                    <a id={{i.id}} class="submitbutton5" type="submit">Save</a>
                                    <a onclick="showhide({{i.id}})">Cancel</a>

                                    <!--                    <a id={{i.id}} class="submitbutton5" type="submit" >Save</a>
                         <a class="submitbutton5" onclick="showhide({{i.id}})" >Cancel</a> -->
                                </div>
                            </form>




                        </div>

                        <!-- EDIT MODE END -->




                        {% endfor %}

                    </div>



                </div>

                <div class="contentRight">
                    <div class="links2">

                    </div>
                    <div class="links3">



                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="myModal" class="modal">

        <!-- Modal content -->


        <div class="modal-content">
            <span class="close">&times;</span> {% for category in categories %}
            <a id="{{category.id}}" class="categorypopups"> {{category.name}} </a> {% endfor %}
        </div>


    </div>
    <script src="../static/js/app.js"></script>
</body>
<script src="../static/js/jquery-3.3.1.min.js"></script>
<script src="//code.jquery.com/jquery-1.9.1.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="../static/js/jQuery-tagEditor-master/jquery.tag-editor.min.js"></script>
<script src="../static/js/jQuery-tagEditor-master/jquery.caret.min.js"></script>





<script>
    $('#tagsID').tagEditor({
        autocomplete: {
            delay: 0, // show suggestions immediately
            position: {
                collision: 'flip'
            }, // automatic menu position up/down
            source: ['notch', 'qb', 'daku']
        },
        forceLowercase: false,

    });
</script>


<script>
    var catty, cattyid, selectedCategory, btn;
    $('.categorypopups').on('click', function() {
        selectedCategory = document.getElementById('popup');
        catty = this.text
        cattyid = this.id
        var text2 = document.createTextNode(catty);
        btn = document.createElement("button");
        btn.appendChild(text2);
        var modal = document.getElementById('myModal');


        modal.style.display = 'none';

        selectedCategory.appendChild(text2);



    });

    $(".heart").on('click', function() {
        console.log($(this));
        var delbutton = $(this).attr('id');
        alert(delbutton)
        $.ajax({
            type: "DELETE",
            url: "http://iitoverflow.herokuapp.com/api/Answers/" + delbutton,
            success: function(result) {
                alert('ok');

            },
            error: function(result) {
                alert(result);
            }
        });




    })

    $(".qheart").on('click', function() {
        console.log($(this));
        var qdelbutton = $(this).attr('id');
        alert(qdelbutton)
        $.ajax({
            type: "DELETE",
            url: "http://iitoverflow.herokuapp.com/api/Questions/" + qdelbutton,
            success: function(result) {
                alert('ok');

            },
            error: function(result) {
                alert(result);
            }
        });




    })


    $(".submitbutton5").click(function() {


        var qid = $(this).attr('id');
        var editorText = CKEDITOR.instances.textarea.getData();
        var posttitle = document.getElementById('titleedit').value;
        var gettags = document.getElementById('tagsIDedit').value;
        var cleartitle = document.getElementById('titleedit');
        var cleartags = document.getElementsByClassName('tag-editor-tag');
        console.log(cleartags);
        // var category = document.getElementsByClassName('categorypopups')[0].id;


        var data = {
            "question": posttitle,
            "questiondesc": editorText,
            "userId": 4
        };

        $.ajax({
            type: "PUT",
            url: "https://iitoverflow.herokuapp.com/api/Questions",
            data: JSON.stringify(data),
            dataType: "json",
            contentType: "application/json",
            success: function(result) {
                console.log(result);
                alert('gaga');
                qid = result.id;

                var tagslength = cleartags.length;




                for (i = 0; i < tagslength; i++) {



                    var data1 = {
                        "name": cleartags[i].innerText,
                        "categoryId": category
                    };
                    console.log(cleartags[i].innerText);


                    // EDIT

                    $.ajax({
                        type: "POST",
                        url: "http://iitoverflow.herokuapp.com/api/Questions/" + qid + "/tags",
                        data: JSON.stringify(data1),
                        dataType: "json",
                        contentType: "application/json",
                        success: function(result1) {
                            // alert('ok');
                            console.log(result1);

                        },
                        error: function(result1) {
                            //alert(result1);
                            console.log(JSON.stringify(result1));
                        }
                    });

                    // EDIT

                }










            },
            error: function(result) {
                alert('error');
            }
        });






    })



    $(".submitbutton3").click(function() {


        var editorText = CKEDITOR.instances.textarea.getData();
        var posttitle = document.getElementById('title').value
        var gettags = document.getElementById('tagsID').value
        var cleartitle = document.getElementById('title');
        var cleartags = document.getElementsByClassName('tag-editor-tag');
        console.log(cleartags);
        var category = document.getElementsByClassName('categorypopups')[0].id;


        var data = {
            "question": posttitle,
            "questiondesc": editorText,
            "categoryId": category,
            "userId": 1
        }

        $.ajax({
            type: "POST",
            url: "https://iitoverflow.herokuapp.com/api/Questions",
            data: JSON.stringify(data),
            dataType: "json",
            contentType: "application/json",
            success: function(result) {
                alert('ok');
                qid = result.id

                var tagslength = cleartags.length




                for (i = 0; i < tagslength; i++) {



                    var data1 = {
                        "name": cleartags[i].innerText,
                        "categoryId": category
                    }
                    console.log(cleartags[i].innerText);

                    // EDIT

                    $.ajax({
                        type: "POST",
                        url: "http://iitoverflow.herokuapp.com/api/Questions/" + qid + "/tags",
                        data: JSON.stringify(data1),
                        dataType: "json",
                        contentType: "application/json",
                        success: function(result) {
                            alert('ok');

                        },
                        error: function(result) {
                            alert(result);
                            console.log(JSON.stringify(result));
                        }
                    });

                    // EDIT

                }

                var question = '<div id="newqedit_' + result.id + '" style="display: block;" class="newdiv">';
                question += '<div class="titlepost">Title: ' + result.question + ' <i onclick="showhide(' + result.id + ')" class="fa fa-reply"></i> <i id="' + result.id + '" class="fa fa-heart qheart"></i><div></div>';

                question += '<div class="descriptionpost">Description:' + result.questiondesc + '<div></div></div><div class="categorypost">Category: ' + result.categoryId + ' <div></div></div><div class="tagspost">Tags: ' + result.cleartags + '<div></div></div><div class="newpostbuttons"><button class="followbutton">Follow</button><button> </button><button class="votebutton">Vote</button><button></button><button class="commentbutton">Comment</button><button></button><button class="answerbutton">Answer</button><button><div></div></button></div><!-- TOEDIT --><div></div><!-- TOEDIT --><div class="answerdiv"><textarea class="answertextarea" id="answer_5" placeholder="Write an Answer"> </textarea><input class="submitanswerbutton" id="5" value="submit" type="button"><div></div></div><div class="newpostinput"><input class="commenttextarea" placeholder="Write a Comment"><div></div></div>';



                question += '</div>';


                $("#newsfeedParent").prepend(question);
                //$("#newsfeedParent").html( question +$("#newsfeedParent").html());
                $('.tag-editor-tag').html("");








            },
            error: function(result) {
                alert('error');
            }
        });


        //var displaytitle = document.getElementById('titlebarid');
        $("#form1").hide('slow');
        $(".submitbutton2").hide('slow');
        $(".popupwrapper").hide('slow');
        $(".tagsarea").hide('slow');
        $("#tagsID+.tag-editor").hide('slow');
        $(".submitbutton3").hide('slow');
        $("newDivs").show('slow');
        $(".titlebar").show('slow');
        $("tagsbar").show('slow');
        $("categorybar").show('slow');

        $('#newDivs').append('<div class="titlepost">' + 'Title: ' + posttitle + '<div>');

        $('#newDivs').append('<div class="descriptionpost">' + 'Description: ' + editorText + '<div>');

        $('#newDivs').append('<div class="categorypost">' + 'Category: ' + catty + '<div>');
        $('#newDivs').append('<div class="tagspost">' + 'Tags: ' + gettags + '<div>');
        $('#newDivs').append('<div class="newpostbuttons"><button class="followbutton">Follow<button> <button class="votebutton" >Vote<button><button class="commentbutton">Comment<button><button class="answerbutton">Answer<button><div>');
        $('#newDivs').append('<div class="answerdiv"><textarea class="answertextarea" placeholder="Write an Answer"></textarea><input class="submitanswerbutton" type="button" value="submit"><div>');
        $('#newDivs').append('<div class="newpostinput"><input class="commenttextarea" placeholder="Write a Comment"><div>');
        cleartitle.value = "";

        selectedCategory.text = "";



    })


    function CKupdate() {
        for (instance in CKEDITOR.instances) {
            CKEDITOR.instances[instance].updateElement();
            CKEDITOR.instances[instance].setData('');
        }
    }
</script>



<script>
    $('.submitanswerbutton').click(function() {

        var qid = $(this).attr('id');
        alert(qid);

        var answer = $("#answer_" + qid).val();
        // var answer = $('.answertextarea#' + qid ).val();  


        alert(answer);
        var data = {
            "answer": answer,
            "questionId": qid,
            "userId": 4
        }

        $.ajax({
            type: "POST",
            url: "https://iitoverflow.herokuapp.com/api/Answers",
            data: JSON.stringify(data),
            dataType: "json",
            contentType: "application/json",
            success: function(result) {
                alert('ok');
            },
            error: function(result) {
                alert(result);
            }
        });

    })
</script>


<script>
    $(document).ready(function() {


        $(".submitbutton2").on('click', function() {
            $("#form1").hide('slow');

        })





        $(".submitbutton4").on('click', function() {
            $("#form2").hide('slow');

        })


        $(".submitanswerbutton").on('click', function() {

        })
    })
</script>
<script>
    $(document).ready(function() {
        $(".submitbutton2").on('click', function() {
            $(".submitbutton3").hide('slow');
        })
    })
</script>
<script>
    $(document).ready(function() {
        $(".submitbutton2").on('click', function() {
            $(".popupwrapper").hide('slow');
        })
    })
</script>
<script>
    $(document).ready(function() {
        $(".submitbutton2").on('click', function() {
            $(".tagsarea").hide('slow');
            $("#tagsID+.tag-editor").hide();
        })
    })
</script>
<script>
    $(document).ready(function() {
        $(".submitbutton2").on('click', function() {
            $(this).hide('slow');
        })



    })
</script>

<script>
    $('.catbuttons').click(function() {
        var category = $(this).val();
        var txt = $(this).text();
        var text = document.createTextNode(txt);
        var popup = document.getElementById('popup');
        $('#myModal').hide('slow');
        popup.appendChild(text);
        $(".categorycontainer").show();

    });
</script>



<script type="text/javascript">
    $(document).ready(function() {
        $(".hider").hide();


        $("#form1").hide();
        $("#tagsID").hide();
        $("#tagsID+.tag-editor").hide();
        $(".popupwrapper").hide();
        $(".submitbutton3").hide();
        $(".submitbutton2").hide();
        $("newDivs").hide();
        $(".titlebar").hide();
        $("tagsbar").hide();
        $("categorybar").hide();
        $(".categorycontainer").hide();
        $('.tag-editor-tag').html("");
        CKupdate();


        $("#title").focus(function() {
            $("#form1").show('slow');
            $("#tagsID+.tag-editor").show('slow');
            $(".tagsarea").show('slow');
            $(".popupwrapper").show('slow');
            $(".submitbutton3").show('slow');
            $(".submitbutton2").show('slow');


            // $('#tagsID').tagEditor({
            //      initialTags: ['Hello', 'World', 'Example', 'Tags'],
            //    delimiter: ', ', /* space and comma */
            //  placeholder: 'Enter tags ...',
            //clickDelete: true,

            //});
        })

    })
</script>


<script type="text/javascript">
    $("#hider").click(function() {

        $("#hider").fadeOut("slow");
        $("#form2").hide("slow");
    });

    function showhide(id) {



        var div = document.getElementById("qedit_" + id);
        var div1 = document.getElementById("newqedit_" + id);
        if (div.style.display !== "none") {
            div.style.display = "none";
            div1.style.display = "block";
            $("#hider").fadeOut("slow");
        } else {
            div.style.display = "block";
            div1.style.display = "none";
            $("#hider").fadeIn('slow');

        }

    }

    function showhide1(id) {


        var x = document.getElementById("duplicate_" + id);
        if (x.style.display === "none") {
            x.style.display = "block";
            $("#hider").fadeOut("slow");
        } else {
            x.style.display = "none";
            $("#hider").fadeOut("slow");
        }
    }
</script>



<script>
    // Get the modal
    var modal = document.getElementById('myModal');

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
<script>
    $('button').click(function() {
        var $this = $(this);
        $this.toggleClass('following')
        if ($this.is('.following')) {
            $this.addClass('wait');
        }
    }).on('mouseleave', function() {
        $(this).removeClass('wait');
    })
</script>